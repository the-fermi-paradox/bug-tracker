#!/bin/env node
const fs = require('fs/promises');
const path = require('path');
const db = require('../database');
const logger = require('../src/helpers/logger');

// A helper script to initialize our database and populate it with tables
// We use MariaDB in this application.
// MySQL may or may not work as a drop in substitute also
(async () => {
  try {
    // First read from the file holding our SQL queries
    /* eslint-disable-next-line security/detect-non-literal-fs-filename */
    const query = await fs.readFile(
      path.join(__dirname, 'schema.mysql'),
      'utf-8',
    );
    // Establish a connection
    const connection = db.connect();
    // Execute our query
    await connection.query(query);
    // Release our connection back to the pool
    db.close(connection);
  } catch (err) {
    logger.error(err);
  }
})();
